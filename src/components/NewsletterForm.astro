<script src="https://f.convertkit.com/ckjs/ck.5.js"></script>

<div class="newsletter-signup bg-muted text-muted-foreground border border-border p-8 rounded-lg my-8">
  <form
    action="https://app.kit.com/forms/7984407/subscriptions"
    class="seva-form"
    method="post"
    data-sv-form="7984407"
    data-uid="8a12095aa0"
    data-format="inline"
    data-version="5"
    data-options='{"settings":{"after_subscribe":{"action":"message","success_message":"Success! Now check your email to confirm your subscription.","redirect_url":""},"analytics":{"google":null,"fathom":null,"facebook":null,"segment":null,"pinterest":null,"sparkloop":null,"googletagmanager":null},"modal":{"trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15},"powered_by":{"show":false,"url":"https://kit.com/features/forms?utm_campaign=poweredby&amp;utm_content=form&amp;utm_medium=referral&amp;utm_source=dynamic"},"recaptcha":{"enabled":false},"return_visitor":{"action":"show","custom_content":""},"slide_in":{"display_in":"bottom_right","trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15},"sticky_bar":{"display_in":"top","trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15}},"version":"5"}'
  >
    <div data-element="header" class="text-center">
      <h3 class="text-2xl font-serif font-bold text-foreground mb-4">Join the Newsletter</h3>
    </div>
    <div data-element="subheader" class="text-muted-foreground/90 mb-6 text-center">
      Subscribe to get our latest content by email.
    </div>

    <ul data-element="errors" data-group="alert" class="mb-4 text-red-600 list-disc list-inside text-center">
      <!-- Errors will be populated here by ConvertKit -->
    </ul>

    <div data-element="fields" class="flex flex-col sm:flex-row gap-4">
      <label for="ck-email-address" class="sr-only">Email Address</label>
      <input
        id="ck-email-address"
        class="flex-grow p-3 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-ring bg-background text-foreground"
        name="email_address"
        aria-label="Email Address"
        placeholder="Enter your email"
        required=""
        type="email"
      />
      <button
        data-element="submit"
        class="bg-primary text-primary-foreground font-medium py-3 px-6 rounded-md hover:bg-link-hover transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-muted cursor-pointer active:scale-95"
      >
        Subscribe
      </button>
    </div>

    <div data-element="guarantee" class="text-xs text-muted-foreground/80 mt-4 text-center">
      We respect your privacy. Unsubscribe at any time.
    </div>
    <div class="text-center mt-4">
        <a
          href="https://kit.com/features/forms?utm_campaign=poweredby&amp;utm_content=form&amp;utm_medium=referral&amp;utm_source=dynamic"
          data-element="powered-by"
          class="text-xs text-muted-foreground/60 hover:text-muted-foreground/80 transition-colors"
          target="_blank"
          rel="nofollow noopener noreferrer"
          >Built with Kit</a
        >
    </div>
  </form>
</div>

<script>
  const form = document.querySelector<HTMLFormElement>('.seva-form[data-uid="8a12095aa0"]');
  const emailInput = form?.querySelector<HTMLInputElement>('#ck-email-address');
  const submitButton = form?.querySelector<HTMLButtonElement>('[data-element="submit"]');
  const guaranteeText = form?.querySelector<HTMLDivElement>('[data-element="guarantee"]');
  const poweredBy = form?.querySelector<HTMLDivElement>('[data-element="powered-by"]')?.parentElement;

  if (form && emailInput && submitButton && guaranteeText && poweredBy) {
    // Add transition classes
    emailInput.classList.add('transition-opacity', 'duration-300', 'ease-in-out');
    guaranteeText.classList.add('transition-opacity', 'duration-300', 'ease-in-out');
    poweredBy.classList.add('transition-opacity', 'duration-300', 'ease-in-out');

    form.addEventListener('ckjs:submission:complete', (event) => {
      // Cast event to CustomEvent to access detail
      const customEvent = event as CustomEvent;
      console.log('CKJS Submission Complete:', customEvent.detail);

      // Ensure button is disabled (CK script might re-enable it)
      submitButton.disabled = true;
      submitButton.classList.remove('active:scale-95', 'hover:bg-link-hover'); // Remove hover/active effects
      submitButton.classList.add('cursor-not-allowed', 'opacity-75');

      // Change button content
      submitButton.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" class="inline-block h-5 w-5 mr-1 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
        </svg>
        Success!
      `;

      // Hide input and guarantee text with fade out
      emailInput.style.opacity = '0';
      guaranteeText.style.opacity = '0';
      poweredBy.style.opacity = '0';

      setTimeout(() => {
        emailInput.style.display = 'none';
        guaranteeText.style.display = 'none';
        poweredBy.style.display = 'none';
      }, 300); // Match transition duration

      // Optional: You might want to prevent the default CK message here if possible,
      // but the event fires slightly before the message logic in their script.
      // Visually replacing the form elements often works well enough.
    });
  }
</script>
